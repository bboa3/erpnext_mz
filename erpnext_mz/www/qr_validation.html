<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Validação de Documento - ERPNext MZ</title>
  <style>
    :root {
      --brand: #02664D;
      --ink: #1E2A38;
      --muted: #6c757d;
      --bg: #f5f7f8;
      --card: #ffffff;
      --border: #e6eaee;
      --valid-bg: #E9F7F6;
      --valid-fg: #02664D;
      --invalid-bg: #fdecea;
      --invalid-fg: #a1372d;
      --info-bg: #f8fafb;
      --shadow: 0 8px 24px rgba(17, 24, 39, .06), 0 2px 8px rgba(17, 24, 39, .04);
      --radius: 14px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: linear-gradient(180deg, #f3f7f6 0%, #f5f5f5 100%);
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap {
      max-width: 960px;
      padding: 24px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin: 8px 0 20px;
    }

    .brand-logo {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-logo .logo {
      display: block;
      height: 40px;
    }

    .brand-text {
      display: block;
    }

    .brand-text h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .2px;
      color: var(--ink);
    }

    .brand-text p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card__body {
      padding: 22px;
    }

    .subheader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 22px;
      border-bottom: 1px solid var(--border);
      background: #fbfcfc;
    }

    .subheader h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--ink);
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: .2px;
    }

    .status--valid {
      background: var(--valid-bg);
      color: var(--valid-fg);
      border: 1px solid #bfe9e3;
    }

    .status--invalid {
      background: var(--invalid-bg);
      color: var(--invalid-fg);
      border: 1px solid #f5c6c2;
    }

    .validation-result {
      margin-bottom: 16px;
    }

    .validation-result p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 16px;
      background: var(--info-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
    }

    @media (max-width:640px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 4px;
      border-bottom: 1px dashed #e9eef2;
    }

    .row:last-child {
      border-bottom: none;
    }

    .label {
      color: #5b6672;
      font-size: 13px;
      font-weight: 600;
    }

    .value {
      color: #2a3340;
      font-size: 14px;
      text-align: right;
      word-break: break-word;
      font-variant-numeric: tabular-nums;
    }

    .loading {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-style: italic;
      padding: 12px 0;
    }

    .skeleton {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(90deg, #e9eef2, #f4f7f9, #e9eef2);
      background-size: 200% 100%;
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        background-position: 0% 0
      }

      100% {
        background-position: 200% 0
      }
    }

    .error {
      color: var(--invalid-fg);
      background: var(--invalid-bg);
      border: 1px solid #f5c6c2;
      padding: 12px 14px;
      border-radius: 10px;
      font-size: 14px;
      margin: 12px 0;
    }

    .footer {
      margin: 20px 0 8px;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="header">
      <div class="brand-logo">
        <!-- MozEconomia Logo -->
        <span class="logo" aria-hidden="true">
          <svg width="180" height="28" viewBox="0 0 309 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M3.54982 9.48535C5.51318 9.48535 7.09964 11.0838 7.09964 13.0619V17.8307C7.09964 19.8088 5.51318 21.4073 3.54982 21.4073C1.58646 21.4073 0 19.8088 0 17.8307V13.0619C0 11.0838 1.58646 9.48535 3.54982 9.48535Z"
              fill="#02664D" />
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M19.5386 0C21.502 0 23.0884 1.613 23.0884 3.6092V17.6895C23.0884 19.6857 21.502 21.2987 19.5386 21.2987C17.5752 21.2987 15.9888 19.6857 15.9888 17.6895V3.6092C15.9888 1.613 17.5752 0 19.5386 0Z"
              fill="#02664D" />
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M11.544 5.01172C13.5073 5.01172 15.0938 6.59497 15.0938 8.55435V17.7389C15.0938 19.6983 13.5073 21.2816 11.544 21.2816C9.5806 21.2816 7.99414 19.6983 7.99414 17.7389V8.55435C7.99414 6.59497 9.5806 5.01172 11.544 5.01172Z"
              fill="#02664D" />
            <path
              d="M0 47.6338V24.5856H4.2834L11.3204 35.4999L18.3574 24.5856H22.702V47.6338H18.6634V31.1098L11.3204 41.9632H11.198L3.97745 31.1708V47.6338H0ZM39.8357 44.2802C40.9779 44.2802 42.0386 44.077 43.0176 43.6705C43.9559 43.2233 44.7718 42.6542 45.4653 41.9632C46.1588 41.1909 46.6891 40.3169 47.0563 39.3413C47.4642 38.3657 47.6682 37.3088 47.6682 36.1707V36.1097C47.6682 34.9715 47.4642 33.9146 47.0563 32.939C46.6891 31.9228 46.1588 31.0691 45.4653 30.3781C44.7718 29.6058 43.9355 28.996 42.9564 28.5489C41.9774 28.1424 40.9167 27.9391 39.7745 27.9391C38.6322 27.9391 37.5716 28.1424 36.5925 28.5489C35.6542 28.996 34.8588 29.5855 34.206 30.3171C33.5125 31.0488 32.9618 31.9025 32.5539 32.8781C32.1867 33.8536 32.0031 34.9105 32.0031 36.0487V36.1097C32.0031 37.2479 32.1867 38.3047 32.5539 39.2803C32.9618 40.2966 33.5125 41.1705 34.206 41.9022C34.8996 42.6339 35.7358 43.2233 36.7149 43.6705C37.6532 44.077 38.6934 44.2802 39.8357 44.2802ZM39.7745 47.9996C38.0203 47.9996 36.3885 47.6948 34.8791 47.085C33.4106 46.4753 32.1459 45.6216 31.0853 44.5241C30.0246 43.4672 29.2087 42.2274 28.6376 40.8047C28.0257 39.3413 27.7197 37.7966 27.7197 36.1707V36.1097C27.7197 34.4837 28.0257 32.9594 28.6376 31.5366C29.2087 30.0732 30.045 28.8131 31.1465 27.7562C32.2071 26.6587 33.4717 25.7847 34.9403 25.1343C36.4497 24.5246 38.0815 24.2197 39.8357 24.2197C41.6306 24.2197 43.2624 24.5246 44.731 25.1343C46.1996 25.7441 47.4642 26.5977 48.5249 27.6953C49.5855 28.7521 50.4218 30.0123 51.0337 31.4756C51.6048 32.8984 51.8904 34.4227 51.8904 36.0487V36.1097C51.8904 37.7357 51.6048 39.2803 51.0337 40.7437C50.4218 42.1664 49.5855 43.4266 48.5249 44.5241C47.4234 45.581 46.1384 46.4346 44.6698 47.085C43.2012 47.6948 41.5694 47.9996 39.7745 47.9996ZM56.0514 47.6338V44.6461L69.6971 28.183H56.4798V24.5856H75.0208V27.5733L61.3751 44.0363H75.0208V47.6338H56.0514ZM80.0997 47.6338V24.5856H97.2945V28.183H84.1995V34.2195H95.7647V37.817H84.1995V44.0363H97.4169V47.6338H80.0997ZM112.898 47.9996C111.185 47.9996 109.614 47.6948 108.187 47.085C106.759 46.4753 105.515 45.642 104.454 44.5851C103.434 43.5282 102.618 42.2681 102.006 40.8047C101.435 39.382 101.15 37.8373 101.15 36.1707V36.1097C101.15 34.4837 101.435 32.939 102.006 31.4756C102.577 30.0529 103.393 28.7928 104.454 27.6953C105.515 26.5977 106.779 25.7441 108.248 25.1343C109.676 24.5246 111.287 24.2197 113.082 24.2197C114.102 24.2197 115.06 24.301 115.958 24.4636C116.815 24.6262 117.61 24.8701 118.344 25.1953C119.079 25.5205 119.752 25.9067 120.364 26.3538C120.976 26.7603 121.547 27.2278 122.077 27.7562L119.507 30.8049C118.569 29.9106 117.59 29.1993 116.57 28.6708C115.509 28.183 114.326 27.9391 113.021 27.9391C111.919 27.9391 110.899 28.1424 109.961 28.5489C109.023 28.996 108.207 29.5855 107.513 30.3171C106.861 31.0488 106.33 31.9025 105.922 32.8781C105.555 33.8536 105.372 34.9105 105.372 36.0487V36.1097C105.372 37.2479 105.555 38.3047 105.922 39.2803C106.33 40.2966 106.861 41.1705 107.513 41.9022C108.207 42.6339 109.023 43.2233 109.961 43.6705C110.899 44.077 111.919 44.2802 113.021 44.2802C114.448 44.2802 115.652 44.016 116.631 43.4875C117.651 42.9591 118.671 42.2274 119.691 41.2925L122.261 43.9753C121.689 44.5851 121.057 45.1542 120.364 45.6826C119.752 46.1298 119.058 46.5566 118.283 46.9631C117.549 47.2883 116.733 47.5525 115.835 47.7557C114.938 47.9183 113.959 47.9996 112.898 47.9996ZM137.742 44.2802C138.884 44.2802 139.925 44.077 140.863 43.6705C141.842 43.2233 142.678 42.6542 143.372 41.9632C144.024 41.1909 144.534 40.3169 144.901 39.3413C145.309 38.3657 145.513 37.3088 145.513 36.1707V36.1097C145.513 34.9715 145.309 33.9146 144.901 32.939C144.534 31.9228 144.004 31.0691 143.31 30.3781C142.617 29.6058 141.801 28.996 140.863 28.5489C139.884 28.1424 138.823 27.9391 137.681 27.9391C136.539 27.9391 135.478 28.1424 134.499 28.5489C133.561 28.996 132.745 29.5855 132.051 30.3171C131.358 31.0488 130.807 31.9025 130.399 32.8781C130.032 33.8536 129.848 34.9105 129.848 36.0487V36.1097C129.848 37.2479 130.032 38.3047 130.399 39.2803C130.807 40.2966 131.358 41.1705 132.051 41.9022C132.745 42.6339 133.581 43.2233 134.56 43.6705C135.539 44.077 136.6 44.2802 137.742 44.2802ZM137.681 47.9996C135.886 47.9996 134.254 47.6948 132.786 47.085C131.317 46.4753 130.052 45.6216 128.992 44.5241C127.931 43.4672 127.095 42.2274 126.483 40.8047C125.912 39.3413 125.626 37.7966 125.626 36.1707V36.1097C125.626 34.4837 125.912 32.9594 126.483 31.5366C127.095 30.0732 127.931 28.8131 128.992 27.7562C130.093 26.6587 131.378 25.7847 132.847 25.1343C134.315 24.5246 135.947 24.2197 137.742 24.2197C139.537 24.2197 141.169 24.5246 142.637 25.1343C144.106 25.7441 145.371 26.5977 146.431 27.6953C147.492 28.7521 148.308 30.0123 148.879 31.4756C149.491 32.8984 149.797 34.4227 149.797 36.0487V36.1097C149.797 37.7357 149.491 39.2803 148.879 40.7437C148.308 42.1664 147.471 43.4266 146.37 44.5241C145.309 45.581 144.045 46.4346 142.576 47.085C141.067 47.6948 139.435 47.9996 137.681 47.9996ZM154.753 47.6338V24.5856H158.547L170.908 40.4998V24.5856H174.946V47.6338H171.52L158.792 31.2318V47.6338H154.753ZM192.141 44.2802C193.284 44.2802 194.324 44.077 195.262 43.6705C196.241 43.2233 197.077 42.6542 197.771 41.9632C198.464 41.1909 198.995 40.3169 199.362 39.3413C199.77 38.3657 199.974 37.3088 199.974 36.1707V36.1097C199.974 34.9715 199.77 33.9146 199.362 32.939C198.995 31.9228 198.444 31.0488 197.71 30.3171C197.057 29.5855 196.241 28.996 195.262 28.5489C194.283 28.1424 193.222 27.9391 192.08 27.9391C190.938 27.9391 189.877 28.1424 188.898 28.5489C187.96 28.996 187.144 29.5855 186.45 30.3171C185.757 31.0488 185.227 31.9025 184.859 32.8781C184.492 33.8536 184.309 34.9105 184.309 36.0487V36.1097C184.309 37.2479 184.492 38.3047 184.859 39.2803C185.227 40.2966 185.757 41.1705 186.45 41.9022C187.144 42.6339 187.98 43.2233 188.959 43.6705C189.938 44.077 190.999 44.2802 192.141 44.2802ZM192.08 47.9996C190.285 47.9996 188.653 47.6948 187.185 47.085C185.716 46.4753 184.452 45.6216 183.391 44.5241C182.33 43.4672 181.494 42.2274 180.882 40.8047C180.311 39.3413 180.025 37.7966 180.025 36.1707V36.1097C180.025 34.4837 180.311 32.9594 180.882 31.5366C181.494 30.0732 182.351 28.8131 183.452 27.7562C184.513 26.6587 185.777 25.7847 187.246 25.1343C188.715 24.5246 190.346 24.2197 192.141 24.2197C193.936 24.2197 195.568 24.5246 197.037 25.1343C198.505 25.7441 199.77 26.5977 200.83 27.6953C201.891 28.7521 202.727 30.0123 203.339 31.4756C203.91 32.8984 204.196 34.4227 204.196 36.0487V36.1097C204.196 37.7357 203.91 39.2803 203.339 40.7437C202.727 42.1664 201.891 43.4266 200.83 44.5241C199.729 45.581 198.444 46.4346 196.975 47.085C195.507 47.6948 193.875 47.9996 192.08 47.9996ZM209.214 47.6338V24.5856H213.497L220.534 35.4999L227.571 24.5856H231.916V47.6338H227.877V31.1098L220.534 41.9632H220.412L213.191 31.1708V47.6338H209.214ZM238.218 47.6338V24.5856H242.257V47.6338H238.218ZM254.434 38.4877H262.389L258.412 29.2806L254.434 38.4877ZM246.418 47.6338L256.576 24.4026H260.37L270.528 47.6338H266.244L263.858 42.0851H252.966L250.579 47.6338H246.418ZM283.072 47.8167C282.134 47.8167 281.277 47.6541 280.502 47.3289C279.727 47.0037 278.972 46.5159 278.238 45.8655L278.85 45.1948C279.176 45.52 279.502 45.7842 279.829 45.9875C280.155 46.2314 280.481 46.4143 280.808 46.5363C281.175 46.6989 281.542 46.8208 281.909 46.9021C282.276 46.9428 282.684 46.9631 283.133 46.9631C283.582 46.9631 283.99 46.9224 284.357 46.8411C284.724 46.7192 285.05 46.5566 285.336 46.3533C285.581 46.1094 285.785 45.8452 285.948 45.5607C286.111 45.2761 286.193 44.9713 286.193 44.6461V44.5851C286.193 44.2599 286.131 43.9753 286.009 43.7314C285.927 43.4876 285.744 43.264 285.458 43.0607C285.214 42.8575 284.887 42.6746 284.479 42.512C284.03 42.3494 283.459 42.1868 282.766 42.0242C282.032 41.9022 281.42 41.7396 280.93 41.5364C280.4 41.3331 279.971 41.0892 279.645 40.8047C279.319 40.5608 279.094 40.2559 278.972 39.8901C278.809 39.5242 278.727 39.1177 278.727 38.6706C278.727 38.2235 278.829 37.7966 279.033 37.3901C279.237 37.0243 279.502 36.6991 279.829 36.4146C280.155 36.13 280.563 35.9064 281.053 35.7438C281.501 35.5812 282.011 35.4999 282.582 35.4999C283.439 35.4999 284.194 35.6219 284.846 35.8658C285.458 36.1097 286.07 36.4755 286.682 36.9633L286.131 37.634C285.56 37.1462 284.989 36.8007 284.418 36.5975C283.847 36.3942 283.215 36.2926 282.521 36.2926C282.113 36.2926 281.726 36.3536 281.358 36.4755C280.991 36.5975 280.665 36.7601 280.379 36.9633C280.135 37.1666 279.951 37.4105 279.829 37.695C279.706 37.9796 279.645 38.2641 279.645 38.5486V38.6096C279.645 38.9348 279.686 39.2194 279.767 39.4633C279.849 39.7072 280.012 39.9307 280.257 40.134C280.543 40.3372 280.91 40.5405 281.358 40.7437C281.807 40.9063 282.399 41.0689 283.133 41.2315C284.52 41.5161 285.519 41.9022 286.131 42.39C286.743 42.9185 287.049 43.6298 287.049 44.5241C287.049 45.0119 286.947 45.459 286.743 45.8655C286.539 46.272 286.274 46.6176 285.948 46.9021C285.581 47.1866 285.152 47.4102 284.663 47.5728C284.173 47.7354 283.643 47.8167 283.072 47.8167ZM289.68 47.6338V46.1704H290.782V47.6338H289.68ZM295.555 43.4875H301.858L298.676 36.5365L295.555 43.4875ZM292.74 47.6338L298.37 35.6219H299.226L304.795 47.6338H303.816L302.286 44.3412H295.188L293.658 47.6338H292.74ZM306.875 47.6338V46.2314H308.038V47.6338H306.875Z"
              fill="#1E2A38" />
          </svg>
        </span>
      </div>
      <div class="brand-text">
        <div>
          <h1>Validação de Documento</h1>
          <p>ERPNext Moçambique • Sistema de Validação Digital</p>
        </div>
      </div>
    </header>

    <section class="card">
      <div class="subheader">
        <h2>Resultado de Validação</h2>
        <!-- status badge gets injected dynamically -->
        <div id="status-badge" class="status" style="display:none;"></div>
      </div>

      <div class="card__body">
        <div id="loading" class="loading">
          <span class="skeleton" aria-hidden="true"></span>
          <span>Carregando informações do documento…</span>
        </div>

        <div id="result" style="display:none;"></div>
      </div>
    </section>

    <p class="footer">
      © <span id="year"></span> MozEconomia • Este verificador confirma a autenticidade e integridade do documento.
    </p>
  </div>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Keep original functionality & IDs intact
    const urlParams = new URLSearchParams(window.location.search);
    const doctype = urlParams.get('doctype');
    const name = urlParams.get('name');
    const hash = urlParams.get('hash');

    const loadingEl = document.getElementById('loading');
    const resultEl = document.getElementById('result');
    const badgeEl = document.getElementById('status-badge');

    if (!doctype || !name) {
      loadingEl.innerHTML =
        '<div class="error">Parâmetros inválidos. Uso: ?doctype=Sales Invoice&name=FAT-2025-00001</div>';
    } else {
      fetch(`/api/method/erpnext_mz.api.validate_document?doctype=${encodeURIComponent(doctype)}&name=${encodeURIComponent(name)}&hash=${encodeURIComponent(hash || '')}`)
        .then(r => r.json())
        .then(data => {
          loadingEl.style.display = 'none';
          displayResult(data);
        })
        .catch(err => {
          loadingEl.innerHTML = `<div class="error">Erro ao validar documento: ${err.message}</div>`;
        });
    }

    function setStatusBadge(valid, text) {
      badgeEl.style.display = 'inline-flex';
      badgeEl.className = 'status ' + (valid ? 'status--valid' : 'status--invalid');
      badgeEl.textContent = text;
    }

    function displayResult(data) {
      resultEl.style.display = 'block';

      if (data.message && data.message.valid) {
        setStatusBadge(true, 'Documento válido');

        const info = data.message.document_info || {};
        const gen = data.message.generated_at ? new Date(data.message.generated_at).toLocaleString('pt-PT') : '';

        resultEl.innerHTML = `
          <div class="validation-result">
            <p>Este documento foi validado com sucesso e é autêntico.</p>
          </div>

          <div class="grid" role="table" aria-label="Informações do Documento">
            <div class="row" role="row">
              <div class="label" role="cell">Tipo</div>
              <div class="value" role="cell">${escapeHtml(info.type)}</div>
            </div>
            <div class="row" role="row">
              <div class="label" role="cell">Número</div>
              <div class="value mono" role="cell">${escapeHtml(info.name)}</div>
            </div>
            <div class="row" role="row">
              <div class="label" role="cell">Empresa</div>
              <div class="value" role="cell">${escapeHtml(info.company)}</div>
            </div>
            <div class="row" role="row">
              <div class="label" role="cell">Data</div>
              <div class="value mono" role="cell">${escapeHtml(info.date)}</div>
            </div>
            <div class="row" role="row">
              <div class="label" role="cell">Valor</div>
              <div class="value mono" role="cell">${escapeHtml(info.amount)} ${escapeHtml(info.currency || '')}</div>
            </div>
            <div class="row" role="row">
              <div class="label" role="cell">Estado</div>
              <div class="value" role="cell">${escapeHtml(info.status)}</div>
            </div>
            ${info.customer ? `
            <div class="row" role="row">
              <div class="label" role="cell">Cliente</div>
              <div class="value" role="cell">${escapeHtml(info.customer)}</div>
            </div>` : ''}

            ${info.tax_id ? `
            <div class="row" role="row">
              <div class="label" role="cell">NUIT</div>
              <div class="value mono" role="cell">${escapeHtml(info.tax_id)}</div>
            </div>` : ''}

            <div class="row" role="row">
              <div class="label" role="cell">Gerado em</div>
              <div class="value mono" role="cell">${escapeHtml(gen)}</div>
            </div>
          </div>
        `;
      } else {
        setStatusBadge(false, 'Documento inválido');
        resultEl.innerHTML = `
          <div class="validation-result">
            <p style="color:var(--invalid-fg)">Não foi possível validar o documento.</p>
            <div class="error">${escapeHtml(data.message ? (data.message.message || 'Documento inválido') : 'Erro desconhecido')}</div>
          </div>
        `;
      }
    }

    // Small XSS-safe helper for any injected text
    function escapeHtml(str) {
      if (str === null || str === undefined) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
  </script>
</body>

</html>